graph TD
A[用户操作] --> B[选择用户A/B]
A --> C[发送消息]
A --> D[查看历史记录]

    B --> E[切换当前用户身份]
    E --> F[加载该用户的聊天历史]
    
    C --> G[消息通过WebSocket发送]
    G --> H[服务器接收并广播]
    H --> I[所有客户端更新UI]
    
    D --> J[从本地存储加载历史记录]
    J --> K[显示在聊天界面]
    
    L[服务器启动] --> M[监听WebSocket连接]
    M --> N[维护连接会话列表]
    N --> O[处理消息广播]
